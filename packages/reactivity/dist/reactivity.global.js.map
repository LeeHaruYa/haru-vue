{
  "version": 3,
  "sources": ["../src/index.ts", "../src/effect.ts", "../../shared/src/index.ts", "../src/baseHandler.ts", "../src/reactive.ts"],
  "sourcesContent": ["export { effect } from \"./effect\";\nexport { reactive } from \"./reactive\";\n", "export let activeEffect = null as any;\nexport let depsMap = new WeakMap();\n\nexport class ReactiveEffect {\n  public active = true;\n  public parent = null;\n  public deps = [];\n  constructor(public fn: Function) { }\n  run() {\n    if (!this.active) {\n      this.fn();\n    } else {\n      try {\n        this.parent = activeEffect\n        activeEffect = this;\n        cleanEffect(this);\n        this.fn();\n      } finally {\n        // \u53D6\u6D88\u5F53\u524D\u6B63\u5728\u8FD0\u884C\u7684effect\n        activeEffect = this.parent;\n        this.parent = null;\n      }\n    }\n  }\n  stop() {\n    if (this.active) {\n      this.active = false;\n      cleanEffect(this);\n    }\n  }\n}\n\nexport function cleanEffect(reactiveEffect) {\n  let deps = reactiveEffect.deps;\n  for (let i = 0; i < deps.length; i++) {\n    deps[i].delete(reactiveEffect)\n  }\n  reactiveEffect.deps.length = 0;\n}\nexport function track(target, key) {\n  if (activeEffect) {\n    let targetMap = depsMap.get(target)\n    if (!targetMap) {\n      depsMap.set(target, targetMap = new Map())\n    }\n    let deps = targetMap.get(key)\n    if (!deps) {\n      targetMap.set(key, deps = new Set())\n    }\n    trackEffect(deps)\n    deps.add(activeEffect);\n  }\n}\n\nexport function trigger(target, key) {\n  let targetMap = depsMap.get(target)\n  if (targetMap) {\n    let deps = targetMap.get(key)\n    if (deps) {\n      triggerEffects(deps)\n    }\n  }\n}\n\nexport function triggerEffects(effects){\n  if (effects) {\n      effects = new Set(effects)\n      effects.forEach(effect => {\n          if (effect !== activeEffect) { // \u4FDD\u8BC1\u8981\u6267\u884C\u7684effect\u4E0D\u662F\u5F53\u524D\u7684effect\n              effect.run();\n          }\n      });\n  }\n}\n\nexport function trackEffect(deps) {\n  if (!activeEffect) {\n    return\n  }\n  const shouldTrack = !deps.has(activeEffect);\n  if (shouldTrack) {\n    activeEffect.deps.push(deps);\n  }\n}\nexport function effect(fn, options = {} as any) {\n  const _effect = new ReactiveEffect(fn);\n  _effect.run();\n  const runner = _effect.run.bind(_effect) as any;\n  runner.effect = _effect; // \u66B4\u9732effect\u7684\u5B9E\u4F8B\n  return runner// \u7528\u6237\u53EF\u4EE5\u624B\u52A8\u8C03\u7528runner\u91CD\u65B0\u6267\u884C\n}\n", "export function isObject(val) {\n  return val !== null && typeof val === \"object\";\n}\n\n\nexport function isFunction(val) {\n  return val !== null && typeof val === \"function\";\n}\n", "import { isObject } from \"@haru-vue/shared/src\";\nimport { track, trigger } from \"./effect\";\nimport { reactive } from './reactive'\n\nexport const enum ReactiveFlags {\n    IS_REACTIVE = '__v_isReactive'\n}\n\nexport function isReactive(value) {\n    return value && value[ReactiveFlags.IS_REACTIVE]\n}\n\nexport const baseHandler = {\n    get: function (target, key, receiver) {\n        if (key === ReactiveFlags.IS_REACTIVE) {\n            return true\n        }\n        const res = Reflect.get(target, key, receiver);\n        track(target, key);\n        if (isObject(res)) {\n            return reactive(res)\n        }\n        return res;\n    },\n    set: function (target, key, value, receiver) {\n        let oldValue = target[key];\n        if (oldValue !== value) {\n            const res = Reflect.set(target, key, value, receiver);\n            trigger(target, key);\n            return res;\n        }\n    },\n}", "import { isObject } from \"@haru-vue/shared\";\nimport { isReactive, baseHandler } from './baseHandler'\n\nexport const reactiveMap = new WeakMap();\nexport function reactive(target) {\n  if (!isObject(target)) {\n    return;\n  }\n  if (isReactive(target)) {\n    return target;\n  }\n  const existingProxy = reactiveMap.get(target);\n  if (existingProxy) {\n    return existingProxy;\n  }\n  const proxy = new Proxy(target, baseHandler as object);\n  reactiveMap.set(target, proxy);\n  return proxy;\n}\n"],
  "mappings": "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",
  "names": ["effect"]
}
